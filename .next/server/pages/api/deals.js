"use strict";(()=>{var e={};e.id=227,e.ids=[227],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},661:e=>{e.exports=require("sqlite3")},8887:e=>{e.exports=import("sqlite")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},5320:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{config:()=>u,default:()=>d,routeModule:()=>c});var r=a(1802),i=a(7153),l=a(6249),s=a(5982),o=e([s]);s=(o.then?(await o)():o)[0];let d=(0,l.l)(s,"default"),u=(0,l.l)(s,"config"),c=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/deals",pathname:"/api/deals",bundlePath:"",filename:""},userland:s});n()}catch(e){n(e)}})},9701:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.d(t,{Il:()=>u,_B:()=>f,nP:()=>d});var r=a(661),i=a.n(r),l=a(8887),s=a(3524),o=e([l]);l=(o.then?(await o)():o)[0];let c=null,f=new s.PrismaClient;async function d(){return c||(c=await (0,l.open)({filename:"./influencer_portal.sqlite",driver:i().Database})),c}async function u(){c&&(await c.close(),c=null),await f.$disconnect()}n()}catch(e){n(e)}})},5982:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{default:()=>l});var r=a(9701),i=e([r]);async function l(e,t){let a=await (0,r.nP)();if("GET"===e.method)try{let e=await a.all(`
                SELECT d.*, i.channelName, i.channelYoutubeId
                FROM deals d
                LEFT JOIN influencers i ON d.influencerId = i.id
            `);for(let t of e){let e=await a.all("SELECT * FROM videos WHERE dealId = ?",t.id);t.videos=e}t.status(200).json(e)}catch(e){console.error("Error fetching deals:",e),t.status(500).json({message:"Error fetching deals",error:e.message})}finally{await (0,r.Il)()}else if("POST"===e.method)try{let{influencerId:n,status:r,uploadMonth:i,deliverables:l,usage:s,recut:o,exclusivity:d,viewGuaranteeAmount:u,viewGuaranteeDays:c,rate:f,postDate:E,uploadLink:P,trackingUrl:p,contractedBy:m,agencyName:h}=e.body,y=await a.run(`
                INSERT INTO deals (
                    influencerId, status, uploadMonth, deliverables, usage, recut, exclusivity,
                    viewGuaranteeAmount, viewGuaranteeDays, rate, postDate, uploadLink,
                    trackingUrl, contractedBy, agencyName
                ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
            `,[n,r,i,l,s,o,d,u,c,f,E,P,p,m,h]),w=await a.get("SELECT * FROM deals WHERE id = ?",y.lastID);t.status(201).json(w)}catch(e){console.error("Error creating deal:",e),t.status(500).json({message:"Error creating deal",error:e.message})}finally{await (0,r.Il)()}else t.setHeader("Allow",["GET","POST"]),t.status(405).end(`Method ${e.method} Not Allowed`)}r=(i.then?(await i)():i)[0],n()}catch(e){n(e)}})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=5320);module.exports=a})();