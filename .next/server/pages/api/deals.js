"use strict";(()=>{var e={};e.id=227,e.ids=[227],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,a)=>{Object.defineProperty(a,"l",{enumerable:!0,get:function(){return function e(a,t){return t in a?a[t]:"then"in a&&"function"==typeof a.then?a.then(a=>e(a,t)):"function"==typeof a&&"default"===t?a:void 0}}})},8393:(e,a,t)=>{t.r(a),t.d(a,{config:()=>c,default:()=>u,routeModule:()=>p});var n={};t.r(n),t.d(n,{default:()=>d});var r=t(1802),l=t(7153),o=t(6249);let s=new(t(3524)).PrismaClient;function i(e,a,t){let n=a.channelName.charAt(0).toUpperCase(),r=t?t.name:"Direct",l="FIXED"===e.pricingType?"F":"C",o="FIXED"===e.pricingType?e.fixedCost:`${e.cpm}y${e.priceCeiling||""}`,s=e.numberOfVideos,i=e.viewGuarantee?`${(e.viewGuarantee/1e3).toFixed(0)}VG${e.viewGuaranteeDays}`:"",d=new Date(e.uploadMonths[0]).toLocaleString("default",{month:"short"});return`${n}, ${r}, ${l} ${o} x ${s} ${i?"x "+i:""} x ${d}`}async function d(e,a){if(console.log("Request method:",e.method),console.log("Request query:",e.query),"GET"===e.method)try{let t;let{influencerId:n}=e.query;console.log("Fetching deals for influencerId:",n),t=n?await s.deal.findMany({where:{influencerId:parseInt(n)},include:{influencer:!0,agency:!0}}):await s.deal.findMany({include:{influencer:!0,agency:!0}}),console.log("Fetched deals:",t),a.status(200).json(t)}catch(e){console.error("Error fetching deals:",e),a.status(500).json({message:"Error fetching deals",error:e})}else if("POST"===e.method)try{let{influencerId:t,agencyId:n,contractedBy:r,pricingType:l,fixedCost:o,cpm:d,priceCeiling:u,viewGuarantee:c,viewGuaranteeDays:p,status:f,numberOfVideos:g,uploadMonths:I,usage:h,deliverable:w}=e.body;console.log("Creating new deal with data:",e.body);let y=0;"FIXED"===l?y=parseFloat(o)*parseInt(g):"CPM"===l&&c&&(y=parseFloat(d)*parseInt(c)/1e3*parseInt(g),u&&y>parseFloat(u)&&(y=parseFloat(u)));let m=await s.influencer.findUnique({where:{id:parseInt(t)}}),P=n?await s.agency.findUnique({where:{id:parseInt(n)}}):null,E=i({pricingType:l,fixedCost:o,cpm:d,priceCeiling:u,viewGuarantee:c,viewGuaranteeDays:p,numberOfVideos:g,uploadMonths:I},m,P),F=await s.deal.create({data:{name:E,influencerId:parseInt(t),agencyId:n?parseInt(n):null,contractedBy:r,pricingType:l,fixedCost:o?parseFloat(o):null,cpm:d?parseFloat(d):null,priceCeiling:u?parseFloat(u):null,viewGuarantee:c?parseInt(c):null,viewGuaranteeDays:p?parseInt(p):null,totalCost:y,status:f,numberOfVideos:parseInt(g),uploadMonths:I,usage:h,deliverable:w}});console.log("Created new deal:",F),a.status(201).json(F)}catch(e){console.error("Error creating deal:",e),a.status(500).json({message:"Error creating deal",error:e})}else if("PUT"===e.method)try{let{id:t}=e.query,{influencerId:n,agencyId:r,contractedBy:l,pricingType:o,fixedCost:d,cpm:u,priceCeiling:c,viewGuarantee:p,viewGuaranteeDays:f,status:g,numberOfVideos:I,uploadMonths:h,usage:w,deliverable:y}=e.body;console.log("Updating deal with id:",t),console.log("Update data:",e.body);let m=0;"FIXED"===o?m=parseFloat(d)*parseInt(I):"CPM"===o&&p&&(m=parseFloat(u)*parseInt(p)/1e3*parseInt(I),c&&m>parseFloat(c)&&(m=parseFloat(c)));let P=await s.influencer.findUnique({where:{id:parseInt(n)}}),E=r?await s.agency.findUnique({where:{id:parseInt(r)}}):null,F=i({pricingType:o,fixedCost:d,cpm:u,priceCeiling:c,viewGuarantee:p,viewGuaranteeDays:f,numberOfVideos:I,uploadMonths:h},P,E),A=await s.deal.update({where:{id:parseInt(t)},data:{name:F,influencerId:parseInt(n),agencyId:r?parseInt(r):null,contractedBy:l,pricingType:o,fixedCost:d?parseFloat(d):null,cpm:u?parseFloat(u):null,priceCeiling:c?parseFloat(c):null,viewGuarantee:p?parseInt(p):null,viewGuaranteeDays:f?parseInt(f):null,totalCost:m,status:g,numberOfVideos:parseInt(I),uploadMonths:h,usage:w,deliverable:y}});console.log("Updated deal:",A),a.status(200).json(A)}catch(e){console.error("Error updating deal:",e),a.status(500).json({message:"Error updating deal",error:e})}else if("DELETE"===e.method)try{let{id:t}=e.query;console.log("Deleting deal with id:",t),await s.deal.delete({where:{id:parseInt(t)}}),console.log("Deal deleted successfully"),a.status(204).end()}catch(e){console.error("Error deleting deal:",e),a.status(500).json({message:"Error deleting deal",error:e})}else a.setHeader("Allow",["GET","POST","PUT","DELETE"]),a.status(405).end(`Method ${e.method} Not Allowed`)}let u=(0,o.l)(n,"default"),c=(0,o.l)(n,"config"),p=new r.PagesAPIRouteModule({definition:{kind:l.x.PAGES_API,page:"/api/deals",pathname:"/api/deals",bundlePath:"",filename:""},userland:n})},7153:(e,a)=>{var t;Object.defineProperty(a,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,a,t)=>{e.exports=t(145)}};var a=require("../../webpack-api-runtime.js");a.C(e);var t=a(a.s=8393);module.exports=t})();